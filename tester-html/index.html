<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><head>
<style>
  body {
    background-color: #000;
    color: #eee;
  }
  h2 {
    margin: 0;
    font-size: 1em;
  }
  #strip {
    position: absolute;
    top: 400px;
    left: 400px;
    width: 100px;
    height: 100px;
    border-top: 1px solid #000;
  }
  .led {
    width:6px;
    height:6px;
    border-radius:4px;
    position:absolute;
  }
  #controls-panel {
    max-width: 30em;
    height: 90vh;
    overflow: auto;
    position: absolute;
    right: 5px;
    background-color: #ccc;
  }
  #controls-list {
    margin: 0;
    padding: 0;
  }
  #controls-list > li {
    display: flex;
    flex-wrap: wrap;
    overflow: hidden;
    padding: 4px 8px 4px 28px;
    opacity: 0.6;
    color: #000;
    list-style-type: none;
    position: relative;
  }
  #controls-list > li.selected {
    overflow: visible;
    opacity: 1;
  }
  #controls-list > li > input[type="radio"] {
    position: absolute;
    left: 0;
    top: 4px;
  }
  #controls-list > li h2 {
    width: 100%;
  }
  #controls-list > li label.param {
    margin: 0 0.5em;
  }
  #send {
    box-sizing: border-box;
    width: 100%;
  }
  #controls-panel footer {
    position: sticky;
    bottom: 0;
    padding: 1em 1em 1em 28px;
    border-top: 1px solid #fff;
    background-color: #ccddff;
  }
</style>
</head>
<body>

<section id="controls-panel">
  <form id="controls-form">
    <ul id="controls-list"></ul>
    <footer>
      <button id="send">Enqueue</button>
    </footer>
  </form>
</section>
<script>
  let theForm = {
    init() {
      this.form = document.querySelector("#controls-form");
      this.sendButton = document.querySelector("#send");
      this.form.addEventListener("click", this);
      this.itemRadios = this.form.querySelectorAll("input[name='animation']");
      this.itemRadios[0].checked = true;
      this.handleSelection({ target: this.itemRadios[0] });
    },
    handleEvent(evt) {
      switch (evt.type) {
        case 'click': {
          if (evt.target.name == "animation") {
            this.handleSelection(evt);
          }
          if (evt.target == this.sendButton) {
            evt.preventDefault();
            this.sendForm();
          }
          break;
        }
      }
    },
    handleSelection(evt) {
      console.log("handleSelection: ", evt);
      for(let input of this.itemRadios) {
        let isSelected = input == evt.target;
        input.closest("li").classList.toggle("selected", isSelected);
      }
    },
    sendForm() {
      let container = document.querySelector("#controls-list > .selected");
      let inputs = container.querySelectorAll("input");
      let data = {};
      for (let input of inputs) {
        let value;
        switch (input.name) {
          case "direction":
            value = input.checked ? -1 : 1;
            break;
          default:
            value = input.value;
        }
        data[input.name] = value;
      }
      if (inputController) {
        console.log("sending request: ", "playanim", data);
        inputController.handleRequest("playanim", data);
      } else {
        console.warn("No inputController to send the data to");
      }
    }
  };
</script>
<!--
remote inputs:
accept name + params for animation
  fade, color1, color2, duration
  ripple, color1, duration
accept reset?
accept wifi credentials?
accept network conditions/errors

outputs:
remote: status response (200 ok etc. )

external parts:
UI for assembling json message and POSTing it to the server
MQTT broker?

input system
  knows how to get inputs from whatever and queue them up for action next time around the loop
  it manages an inputs buffer
updateAnimationState
  turns the inputs it finds into rgb values for this frame. It manages the animation tracks
  and could do tweening.
  it leaves messages or other output for the output system to do stuff with
  it manages an outputs buffer
  it manages a series of animation tracks

output system
  serial output?
  server response
  render to led strip: compose together the tracks to produce output for the LED strip
-->

<h1>Animation tester</h1>

<div id="strip"></div>
<script type="text/javascript" src="./tester.js"></script>
<script type="text/javascript" src="./Fx_Controller.js"></script>
<script type="text/javascript" src="./Input_Controller.js"></script>
<script type="text/javascript" src="./Fx_Animations.js"></script>
</body>
</html>
